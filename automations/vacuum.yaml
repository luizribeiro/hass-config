- alias: "Start the Vacuum"
  trigger:
    platform: time
    at: '16:00:00'
  condition:
    condition: and
    conditions:
      - condition: time
        weekday:
          - mon
          - tue
          - wed
          - thu
          - fri
      - condition: state
        entity_id: input_select.home_mode
        state: 'Away'
  action:
    - service: vacuum.set_fan_speed
      data_template:
        entity_id: vacuum.xiaomi_vacuum_cleaner
        # only run in max fan speed on Mondays
        fan_speed: "{{'Max' if now().weekday() == 1 else 'Balanced'}}"
    - service: vacuum.start
      data:
        entity_id: vacuum.xiaomi_vacuum_cleaner

- alias: "Retry on Vacuum errors"
  trigger:
    platform: state
    entity_id: vacuum.xiaomi_vacuum_cleaner
    to: error
  condition:
    condition: numeric_state
    entity_id: counter.num_vacuum_retries_today
    below: 2
  action:
    - service: counter.increment
      data:
        entity_id: counter.num_vacuum_retries_today
    - service: vacuum.start
      data:
        entity_id: vacuum.xiaomi_vacuum_cleaner

- alias: "Reset Vacuum retry counter"
  trigger:
    platform: time
    at: "00:00:00"
  action:
    - service: counter.reset
      data:
        entity_id: counter.num_vacuum_retries_today
